<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <title>Document</title>
    </head>

    <link rel="stylesheet" href="styles.css">

    <body>
        <div class="header">
            <h1>Demo Screen Recorder</h1>
        </div>

        <video id="myVideo" width="900" height="500" controls></video>

        <div id="buttonGDiv">
            <div id="buttons">
                <button class="btn" id="button2" onClick="start()">Click to begin!</button>
                <button class="btn" id="button3">Click to stop!</button>
                <button class="btn" id="button4">Click to pause/resume!</button>
            </div>
        </div>
        
        <script>

            /*
            TODO:
                -convenciones de codigo 
                    - no usar id porque es practicamente igual a classes
                    - usar classes en lugar de id, react usa class Name entonces ayuda
                    - nombres de variables más claras
                    - ejemplo: div buttons, boton 1 = buttons--button-start
                    - "--" para indicar que es un child de, y un "-" para un mismo nombre pero largo
                
                - buscar que paquetes se necesitan para usar RTC en React.
                - pasar este proyecto a React, en luagr de html JSX y así. 
            */

            function pausee(rm) {
                return rm.pause();
            }

            const start = async () => {
                // stream is a MediaStream object.
                const stream = await navigator.mediaDevices.getDisplayMedia({
                    video: {
                        mediaSource: "screen",
                    },
                });
                // data = Blob array;
                const data = [];
                
                const mediaRecorder = new MediaRecorder(stream);

                // continous contruction of the blob array;
                mediaRecorder.ondataavailable = (e) => {
                    data.push(e.data);
                };

                //console.log(stream.active);
                mediaRecorder.start(); // we need to start the recording.

                //mediaRecorder.state = pausee(mediaRecorder);

                console.log(mediaRecorder.state);

                // this works too line 47 to 60 //
                /*mediaRecorder.onpause = function(e) {
                    if (mediaRecorder.state === "recording") {
                        mediaRecorder.pause();
                        console.log("1");
                        console.log(mediaRecorder.state);
                        
                    }
                    else if (mediaRecorder.state === "paused") {
                        mediaRecorder.resume();
                        console.log("2");
                        console.log(mediaRecorder.state);
                    }
                }*/

                /*mediaRecorder.addEventListener('pause', function (e) {
                    //pause.onclick = function() {
                    mediaRecorder.onpause = function() {
                        if (MediaRecorder.state === "recording") {
                            mediaRecorder.pause();
                        }
                        else if (MediaRecorder.state === "paused") {
                            mediaRecorder.resume();
                        }
                    }
                });*/

                // event listener to stop recording //
                var btn3 = document.getElementById("button3");
                btn3.addEventListener("click", () => {
                    // the stream is finished.
                    stream.getTracks().forEach( track => track.stop() ); // stop all tracks.
                    //stream.active = false; this property is read only, cannot be directly affected.
                    console.log(stream.active);
                })


                // event listener to pause and resume recording //
                var btn4 = document.getElementById("button4");
                btn4.addEventListener("click", () => {

                    if (mediaRecorder.state === "recording") {
                        //stream.getTracks().forEach( track => track.pause() ); // pause all tracks.
                        mediaRecorder.pause();
                        console.log("video paused");
                        console.log(mediaRecorder.state);
                    }
                    else if (mediaRecorder.state === "paused") {
                        // stream.getTracks().forEach( track => track.resume() ); // resume all tracks.
                        mediaRecorder.resume();
                        console.log("video resumed");
                        console.log(mediaRecorder.state);
                    }
                })

                //mediaRecorder.stop(); A sole stop doesn't stop all tracks.
                
                mediaRecorder.onstop = (e) => {
                    console.log(stream.active);
                    console.log(mediaRecorder.state);
                    // When stopped display video.
                    document.querySelector("video").src = URL.createObjectURL(
                        new Blob(data, {
                            type: data[0].type,
                        })
                    );
                };
            };
        </script>
    </body>
</html>
